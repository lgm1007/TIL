## VPC (Virtual Private Cloud) 개념
- **VPC**: AWS 계정 사용자 전용 가상의 네트워크, AWS용 개인 네트워크 망 데이터센터
- 사용자가 자신이 원하는대로 IP 주소 범위 선택, 서브넷 생성, 라우팅 테이블 및 네트워크 게이트웨이 구성 등 가상 네트워크 환경을 구성해 VPC를 생성할 수 있다.
- Amazon VPC가 도입된 이후로 인스턴스가 VPC에 속함으로써 네트워크를 구분할 수 있고 VPC 별로 필요한 설정을 통해 인스턴스에 네트워크 설정을 적용할 수 있게 됐다.

## VPC 구성 요소
- AWS Cloud 내에는 IDC의 집합인 리전 (Region)이 존재하며, 리전은 2개의 가용영역으로 이루어져 있다.
- VPC는 리전에 상응하는 규모의 네트워크
- VPC는 독립된 하나의 네트워크를 구성하기 위한 가장 큰 단위이다.
- VPC는 리전에 하나씩이다. 다른 리전에 걸쳐서 확장은 불가능하다.
- 원래 규정된 사설 IP 범위와는 다르게, AWS에서는 `/16~/28` 비트의 서브넷 마스크만을 허용한다. 즉 AWS VPC를 생성할 수 있는 가장 큰 IP 대역은 `/16`이며, 가장 작은 대역은 `/28`이다.
- VPC에서 한번 설정된 IP 대역은 수정할 수 없으며, 각각의 VPC는 독립적이기 때문에 서로 통신할 수 없다.
    - 통신을 원한다면 VPC 피어링 서비스를 통해 VPC 간에 트래픽을 라우팅할 수 있도록 설정할 수 있다.

## 서브넷 (Subnet)
- **서브넷**: VPC의 IP 주소를 나누어 리소스가 배치되는 물리적인 주소 범위를 뜻한다.
- VPC가 논리적인 범위를 의미한다면, 서브넷은 VPC안에서 실제로 리소스가 생성될 수 있는 네트워크 영역이라고 생각하면 된다.
- 실제로 EC2, RDS 같은 리소스를 생성할 수 있다.
- 하나의 VPC에 n개의 서브넷을 가질 수 있으며, 하나의 가용영역에만 생성이 가능하다.
- 서브넷 역시 VPC처럼 CIDR 범위는 `/16~/28`을 사용할 수 있다.
    - 예) VPC(`10.0.0.0/16`) 내에서 크기를 두 개로 쪼개 서브넷(`10.0.1.0/24`)이다.
- AWS는 관리용으로 사용하는 IP가 존재하는데, 이는 사용자가 사용할 수 없는 AWS 예약 주소이다.

| IP         | 용도                                                   |
| ---------- | ---------------------------------------------------- |
| 10.0.0.0   | 네트워크 주소                                              |
| 10.0.0.1   | VPC 라우터용 예약 주소                                       |
| 10.0.0.2   | DNS 서버 주소<br>DNS 서버의 IP 주소는 기본 VPC 네트워크 범위에 2를 더한 주소 |
| 10.0.0.3   | 앞으로 사용하려고 예약한 주소                                     |
| 10.0.0.255 | 네트워크 브로드캐스트 주소                                       |
- 네트워크 이론 상 호스트 범위의 첫 번째 주소와 마지막 주소는 네트워크 주소, 브로드캐스트 주소라 이용할 수 없는데, AWS에서는 거기에 +3개를 이용할 수 없다.

## Public Subnet / Private Subnet
- Public Subnet: 인터넷에 접근 가능한 (VPC 외부/내부와 통신)
- Private Subnet: 인터넷에 접근 불가능한 (VPC 내부에서만 통신)
- Private 서브넷 내부의 인스턴스들은 오직 다른 서브넷과만 연결 가능한데, 만약 인터넷 연결이 필수라면 `NAT instance`를 통해 Private 서브넷 내부의 인스턴스들이 인터넷을 가능하게 할 수도 있다.
### 서브넷 구조 완성형 예시
- Public 서브넷인 10.0.1.0/24와 10.0.2.0/24는 EC2 다수를 탑재해야 하는 경우: 다수의 사설 IP 필요하므로 CIDR 값을 낮게 줘서 `/24` (256개) 서브넷 범위를 크게 나누었다.
- Private 서브넷인 10.0.3.0/25와 10.0.4.0/25는 소수의 서비스를 탑재하는 경우: IP 많이 필요하지 않아 CIDR 값을 높게 `/25` (128개) 주었다.
- 정리하면 다음과 같은 구성
    - VPC: 10.0.0.0/16
    - Public 서브넷: 10.0.1.0/24, 10.0.2.0/24
    - Private 서브넷: 10.0.3.0/25, 10.0.4.0/25

## 인터넷 게이트웨이
- VPC는 기본적으로 격리된 네트워크 환경이다. 따라서 VPC에 생성된 리소스들은 기본적으로 인터넷을 사용할 수 없다.
- 이러한 환경에서, 인터넷 게이트웨이는 VPC의 인스턴스와 인터넷 간에 통신을 할 수 있게 해준다.
- **인터넷 게이트웨이**: VPC의 리소스와 인터넷 간의 통신을 활성화하기 위해 VPC에 연결하는 관문이다.
- 인터넷으로 데이터를 보내야 한다면 인터넷 게이트웨이로 트래픽을 전달해야 한다.

## 라우팅 테이블
- 각 서브넷의 라우팅 테이블을 수정하여, Public 서브넷은 외부와 통신할 수 있게, Private 서브넷은 외부에서는 통신할 수 없고 내부에서만 가능하게 라우팅 설정을 한다.
- Public 라우팅 테이블에 인터넷 게이트웨이를 연결해주면 Public 서브넷 등록 가능해진다.