# Cascade 주의사항
### Cascade (영속성 전이)
* 특정 엔티티를 영속 상태로 만들 때 **연관관계에 있는 엔티티도 함께 영속 상태**로 만들기 위해 사용한다.
* 부모 엔티티를 다룰 때 연관되어있는 자식 엔티티까지 다루기 위함

### JPA CascadeType 옵션
* CascadeType.**ALL**
  * 아래 CascadeType 들이 모두 적용됨
* CascadeType.**PERSIST**
  * 엔티티를 영속화할 때, 연관된 엔티티도 함께 유지
* CascadeType.**MERGE**
  * 엔티티 상태를 병합할 때, 연관된 엔티티도 함께 병합
* CascadeType.**REMOVE**
  * 엔티티를 제거할 때, 연관된 엔티티도 함께 제거
* CascadeType.**DETACH**
  * 부모 엔티티를 영속성 컨텍스트로부터 분리하면, 연관된 엔티티도 함께 분리되며 변경 사항에 대해 반영되지 않는 상태가 됨
* CascadeType.**REFRESH**
  * 부모 엔티티를 새로고침할 때, 연관된 엔티티도 함께 새로고침
  * 새로고침: 데이터베이스로부터 실제 레코드의 값을 즉시 로딩해 덮어씌운다는 의미

### Cascade 가 위험한 이유
1. **참조 무결성 제약조건 위반 가능성**
    * CascadeType.REMOVE 또는 CascadeType.ALL 옵션을 사용하면 엔티티 삭제 시 연관된 엔티티들이 전부 삭제가 됨
    * 의도치 않게 참조 무결성 제약조건을 위반할 수 있다.
      * `참조 무결성 제약조건`: R-DB 에서 릴레이션은 참조할 수 없는 외래키를 가져서는 안 된다는 조건
    * 실제 운영 환경에서는 개발 편의를 위해 외래키 제약조건을 사용하지 않는 경우도 많은데, 이런 경우는 예외도 발생하지 않아 데이터 정합성 문제가 발생할 가능성이 크다.
2. **양방향 연관관계 매핑 시 충돌 가능성**
    * 영속성 전이(Cascade)는 **관리하는 부모가 단 하나일 때** 사용해야 한다.

### Cascade를 사용해야 할 때
* Cascade는 **엔티티 간 관계가 명확할 때 사용할 것을 권장**한다.
  * 단순히 개발하기 편해서, 로직이 간결해진다는 이유로 사용하면 추후 큰 문제가 발생할 것
* 부모 - 자식 구조가 명확하다면 사용해도 좋다.
  * 하지만, 하나의 자식에 여러 부모가 대응되는 경우에는 사용하지 않는 것이 좋다.
    * (Ex. 수강 중인 수업 - 학생들)
